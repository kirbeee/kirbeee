"use strict";(self.webpackChunkkirbee_website=self.webpackChunkkirbee_website||[]).push([[6769],{75396:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"AWS/Cloud Integration/SQS","title":"SQS (Simple Queue Service)","description":"SQS","source":"@site/docs/AWS/Cloud Integration/SQS.md","sourceDirName":"AWS/Cloud Integration","slug":"/AWS/Cloud Integration/SQS","permalink":"/kirbeee/docs/AWS/Cloud Integration/SQS","draft":false,"unlisted":false,"editUrl":"https://github.com/kirbeee/kirbeee/docs/AWS/Cloud Integration/SQS.md","tags":[],"version":"current","lastUpdatedBy":"kirbeee","lastUpdatedAt":1744362010000,"frontMatter":{"title":"SQS (Simple Queue Service)"},"sidebar":"docs","previous":{"title":"SNS (Simple Notification Service)","permalink":"/kirbeee/docs/AWS/Cloud Integration/SNS"},"next":{"title":"Introduction","permalink":"/kirbeee/docs/AWS/Cloud Integration/intro"}}');var t=i(74848),l=i(28453);const r={title:"SQS (Simple Queue Service)"},a="SQS (Simple Queue Service)",c={},o=[{value:"Standard Queues",id:"standard-queues",level:2},{value:"Attributes",id:"attributes",level:3},{value:"Producing messages",id:"producing-messages",level:3},{value:"Consuming messages",id:"consuming-messages",level:3},{value:"Multiple EC2 Instances Consumers",id:"multiple-ec2-instances-consumers",level:4},{value:"SQS with Auto Scaling Group (ASG)",id:"sqs-with-auto-scaling-group-asg",level:4},{value:"SQS to decouple between application tiers",id:"sqs-to-decouple-between-application-tiers",level:4},{value:"Security",id:"security",level:2},{value:"Message Visibility Timeout",id:"message-visibility-timeout",level:2},{value:"Long Polling",id:"long-polling",level:3},{value:"Decoupling applications",id:"decoupling-applications",level:2},{value:"FIFO Queues",id:"fifo-queues",level:2},{value:"SQS as a buffer to database writes",id:"sqs-as-a-buffer-to-database-writes",level:2}];function d(e){const s={h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"sqs-simple-queue-service",children:"SQS (Simple Queue Service)"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"SQS",src:i(69342).A+"",width:"2444",height:"1024"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Oldest AWS offering (over 10 years old)"}),"\n",(0,t.jsx)(s.li,{children:"Fully managed service (~serverless), used to decouple applications"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"standard-queues",children:"Standard Queues"}),"\n",(0,t.jsx)(s.h3,{id:"attributes",children:"Attributes"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Unlimited throughput, unlimited number of messages in queue"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Default retention of messages: 4 days, maximum of 14 days"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Low latency ( less 10 ms on publish and receive)"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Limitation of 256KB per message sent"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Can have duplicate messages (at least once delivery, occasionally)"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Can have out of order messages (best effort ordering)"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"producing-messages",children:"Producing messages"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Produced to SQS using the SDK (SendMessage API)"}),"\n",(0,t.jsx)(s.li,{children:"The message is persisted in SQS until a consumer deletes it"}),"\n",(0,t.jsx)(s.li,{children:"Message retention: default 4 days, up to 14 days"}),"\n",(0,t.jsxs)(s.li,{children:["Example: send an order to be processed","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Order id"}),"\n",(0,t.jsx)(s.li,{children:"Customer id"}),"\n",(0,t.jsx)(s.li,{children:"Any attributes you want"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["SQS standard: unlimited throughput\n",(0,t.jsx)(s.img,{alt:"img.png",src:i(3786).A+"",width:"514",height:"245"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"consuming-messages",children:"Consuming messages"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Consumers (running on EC2 instances, servers, or AWS Lambda)\u2026"}),"\n",(0,t.jsx)(s.li,{children:"Poll SQS for messages (receive up to 10 messages at a time)"}),"\n",(0,t.jsx)(s.li,{children:"Process the messages (example: insert the message into an RDS database)"}),"\n",(0,t.jsxs)(s.li,{children:["Delete the messages using the DeleteMessage API\n",(0,t.jsx)(s.img,{alt:"img.png",src:i(25732).A+"",width:"1187",height:"321"})]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"multiple-ec2-instances-consumers",children:"Multiple EC2 Instances Consumers"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Consumers receive and process messages in parallel"}),"\n",(0,t.jsx)(s.li,{children:"At least once delivery"}),"\n",(0,t.jsx)(s.li,{children:"Best-effort message ordering"}),"\n",(0,t.jsx)(s.li,{children:"Consumers delete messages after processing them"}),"\n",(0,t.jsxs)(s.li,{children:["We can scale consumers horizontally to improve throughput of processing\n",(0,t.jsx)(s.img,{alt:"img.png",src:i(46183).A+"",width:"678",height:"482"})]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"sqs-with-auto-scaling-group-asg",children:"SQS with Auto Scaling Group (ASG)"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"img.png",src:i(67198).A+"",width:"1184",height:"555"})}),"\n",(0,t.jsx)(s.h4,{id:"sqs-to-decouple-between-application-tiers",children:"SQS to decouple between application tiers"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"img.png",src:i(43982).A+"",width:"1200",height:"386"})}),"\n",(0,t.jsx)(s.h2,{id:"security",children:"Security"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Encryption:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"In-flight encryption using HTTPS API"}),"\n",(0,t.jsx)(s.li,{children:"At-rest encryption using KMS keys"}),"\n",(0,t.jsx)(s.li,{children:"Client-side encryption if the client wants to perform encryption/decryption itself"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"Access Controls: IAM policies to regulate access to the SQS API"}),"\n",(0,t.jsxs)(s.li,{children:["SQS Access Policies (similar to S3 bucket policies)","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Useful for cross-account access to SQS queues"}),"\n",(0,t.jsx)(s.li,{children:"Useful for allowing other services (SNS, S3\u2026) to write to an SQS queue"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"message-visibility-timeout",children:"Message Visibility Timeout"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"After a message is polled by a consumer, it becomes invisible to other consumers"}),"\n",(0,t.jsx)(s.li,{children:"By default, the \u201cmessage visibility timeout\u201d is 30 seconds"}),"\n",(0,t.jsx)(s.li,{children:"That means the message has 30 seconds to be processed"}),"\n",(0,t.jsxs)(s.li,{children:["After the message visibility timeout is over, the message is \u201cvisible\u201d in SQS\n",(0,t.jsx)(s.img,{alt:"img_1.png",src:i(84107).A+"",width:"1114",height:"345"}),"\n",(0,t.jsx)(s.img,{alt:"img.png",src:i(20934).A+"",width:"1129",height:"364"})]}),"\n",(0,t.jsx)(s.li,{children:"If a message is not processed within the visibility timeout, it will be processed twice"}),"\n",(0,t.jsx)(s.li,{children:"A consumer could call the ChangeMessageVisibility API to get more time"}),"\n",(0,t.jsx)(s.li,{children:"If visibility timeout is high (hours), and consumer crashes, re-processing will take time"}),"\n",(0,t.jsx)(s.li,{children:"If visibility timeout is too low (seconds), we may get duplicates"}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"long-polling",children:"Long Polling"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:'When a consumer requests messages from the queue, it can optionally "wait" for messages to arrive if there are none in the queue'}),"\n",(0,t.jsx)(s.li,{children:"This is called Long Polling"}),"\n",(0,t.jsx)(s.li,{children:"LongPolling decreases the number of API calls made to SOS while increasing the efficiency and reducing latency of your application"}),"\n",(0,t.jsx)(s.li,{children:"The wait time can be between I sec to 20 sec(20 sec preferable)"}),"\n",(0,t.jsx)(s.li,{children:"Long Polling is preferable to Short Polling"}),"\n",(0,t.jsxs)(s.li,{children:["Long Polling can be enabled at the queue level or at the API level using WaitTimeSeconds\n",(0,t.jsx)(s.img,{alt:"img.png",src:i(25993).A+"",width:"384",height:"633"})]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"decoupling-applications",children:"Decoupling applications"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"decoupling",src:i(57844).A+"",width:"2600",height:"1076"})}),"\n",(0,t.jsx)(s.h2,{id:"fifo-queues",children:"FIFO Queues"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"FIFO",src:i(64477).A+"",width:"2352",height:"412"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Limited throughput: 300 msg/s without batching, 3000 msg/s with"}),"\n",(0,t.jsx)(s.li,{children:"Exactly-once send capability (by removing duplicates using Deduplication ID)"}),"\n",(0,t.jsx)(s.li,{children:"Messages are processed in order by the consumer"}),"\n",(0,t.jsx)(s.li,{children:"Ordering by Message Group ID (all messages in the same group are ordered) \u2013 mandatory parameter"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"sqs-as-a-buffer-to-database-writes",children:"SQS as a buffer to database writes"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"img.png",src:i(5545).A+"",width:"1378",height:"494"})})]})}function u(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},64477:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/FIFO-queue-a3b05f87345b5009ebd18ce2ff7efdae.png"},67198:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/SQS-ASG-eef8cefffc7f702fc6034c6bb9b3c63a.png"},69342:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/SQS-e852d9cfe3ed2e031e56786a076fdbc4.png"},5545:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/buffer-database-b567e29c3283311bb877ec987c93e3d1.png"},25732:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/consuming-message-0a3237ae18f044801e82ee4c53e6853c.png"},57844:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/decoupling-example-62ac8402b6093e9321a02d8b7a24c6b3.png"},43982:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/frontend-backend-0f4a16927a5032995cc0c70af5e7dc06.png"},25993:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/long-polling-e47f4b298b2ca70e3501b92f6165dfa3.png"},46183:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/multi-EC2-consumers-ac860162a270ebfa4f652007a0869339.png"},3786:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/producing-message-3fb9956e18d5142e73342c2570dfece3.png"},20934:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/visibility-timeout-2-52dbe68318e88484a8a347e4f4c3fe03.png"},84107:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/visibility-timeout-e38b272aeed22a947037bbdb97342211.png"},28453:(e,s,i)=>{i.d(s,{R:()=>r,x:()=>a});var n=i(96540);const t={},l=n.createContext(t);function r(e){const s=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(l.Provider,{value:s},e.children)}}}]);